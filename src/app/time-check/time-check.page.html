<ion-header>
  <ion-toolbar>
    <ion-title>시간 입력</ion-title>
  </ion-toolbar>
</ion-header>
 
<ion-content>
  <ion-item>
      <ion-datetime 
        *ngIf="dateType == 'all';else savedOnly"
        displayFormat="YYYY-MM-DD" 
        pickerFormat="YYYY-MM-DD"
        min="2021-04-25" 
        max="2030"
        [(ngModel)]="datePicker"
        (ionChange)="onChangeDateType(datePicker, dateType)">
      </ion-datetime>
    <ng-template #savedOnly>
      <ion-select [(ngModel)]="datePicker" (ionChange)="onChangeDateType(datePicker, dateType)">
        <ion-select-option *ngFor="let date of savedDates" [value]="date">{{date}}</ion-select-option>
      </ion-select>
    </ng-template>
    <ion-select [(ngModel)]="dateType" [disabled]="!savedDates.length" (ionChange)="onChangeDateType(datePicker, dateType)">
      <ion-select-option value="all">전체</ion-select-option>
      <ion-select-option value="savedOnly">기록</ion-select-option>
    </ion-select>
  </ion-item>
  <ion-item>
    <span class="ion-padding-start">
      <ion-button 
        color="success" 
        fill="solid" 
        slot="end" 
        (click)="filterGroups($event.target.nextSibling, true)" 
        clickable>주간</ion-button>
      <ion-button 
        color="medium" 
        fill="solid" 
        slot="end" 
        (click)="filterGroups($event.target.previousElementSibling, false)" 
        clickable>야간</ion-button>
    </span>
  </ion-item>
  <ion-list>
    <ion-card *ngFor="let group of filteredGroups; let idx = index;">
      <ion-card-header color="primary">
        <ion-label>{{group.location}}</ion-label>
      </ion-card-header>
      <ion-item *ngFor="let recoder of group.recoders; let recoderIdx = index;">
        <ion-grid>
          <ion-row>
            <ion-col size-sm="2">
              <ion-label position="floating">{{recoder.station}}</ion-label>              
            </ion-col>
            <ion-col size-sm="5">
              <ion-input 
                type="text" 
                id="{{_TIME_TYPE[0]}}-{{idx}}-{{recoderIdx}}"
                maxlength="4"
                inputmode="numeric"
                placeholder="점검시간"
                [(ngModel)]="recoder.savedTime"
                [attr.hasNext]="true"
                [appShiftFocus]="_TIME_TYPE"
                [readonly]="dateType == 'savedOnly'"
                (keyup)="save()"
              ></ion-input>
            </ion-col>
            <ion-col size-sm="5">
              <ion-input 
                type="text"
                id="{{_TIME_TYPE[1]}}-{{idx}}-{{recoderIdx}}"
                maxlength="4"
                inputmode="numeric" 
                placeholder="저장된시간"
                [(ngModel)]="recoder.checkTime"
                [attr.hasNext]="!!group.recoders[recoderIdx+1]"
                [appShiftFocus]="_TIME_TYPE"
                [readonly]="dateType == 'savedOnly'"
                (keyup)="save()"
              ></ion-input>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-item>
    </ion-card>
  </ion-list>
</ion-content>